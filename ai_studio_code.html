<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIN Lookup Service</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f4f6f9; --surface-color: #ffffff; --primary-color: #0d6efd;
            --secondary-color: #dc3545; --text-color: #212529; --border-color: #dee2e6;
            --highlight-color: #e9ecef; --font-family: 'IBM Plex Sans Arabic', sans-serif;
        }
        * { box-sizing: border-box; }
        body {
            font-family: var(--font-family); background-color: var(--bg-color); color: var(--text-color);
            margin: 0; line-height: 1.6;
        }
        .main-container {
            max-width: 800px; margin: 40px auto; padding: 30px;
            background-color: var(--surface-color); border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }
        .header .highlight {
            background-color: #ffc107; padding: 5px 15px; border-radius: 5px;
            font-weight: 500; display: inline-block;
        }
        .header p { color: #6c757d; font-size: 1.1rem; max-width: 600px; margin: 15px auto 0; }
        .filter-grid { display: grid; gap: 20px; margin-bottom: 25px; }
        .combobox-container { position: relative; }
        .combobox-input {
            width: 100%; padding: 12px 15px; font-family: var(--font-family); font-size: 1rem;
            border: 1px solid var(--border-color); border-radius: 6px; transition: border-color 0.2s, box-shadow 0.2s;
        }
        .combobox-input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25); outline: none; }
        .suggestions-box {
            display: none; position: absolute; top: 100%; left: 0; right: 0; z-index: 100;
            background-color: var(--surface-color); border: 1px solid var(--border-color);
            border-radius: 0 0 6px 6px; max-height: 200px; overflow-y: auto; box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        .suggestion-item { padding: 10px 15px; cursor: pointer; }
        .suggestion-item:hover { background-color: var(--highlight-color); }
        .button-group { display: flex; gap: 15px; }
        .button {
            flex-grow: 1; padding: 12px; font-family: var(--font-family); font-size: 1rem;
            font-weight: 500; border: none; border-radius: 6px; cursor: pointer; transition: opacity 0.2s, background-color 0.2s;
        }
        .button:disabled { background-color: #6c757d; cursor: not-allowed; }
        .button:hover:not(:disabled) { opacity: 0.9; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-secondary { background-color: var(--secondary-color); color: white; }
        .results-section { display: none; margin-top: 40px; }
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .results-header h3 { margin: 0; }
        .btn-export { background: #198754; color: white; padding: 8px 15px; font-size: 0.9rem; }
        #resultsTable { width: 100%; border-collapse: collapse; }
        #resultsTable th, #resultsTable td { padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); }
        #resultsTable thead { background-color: var(--highlight-color); }
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: var(--surface-color); padding: 25px; border-radius: 8px;
            width: 90%; max-width: 550px;
        }
        .modal-body { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .modal-body textarea { grid-column: 1 / -1; height: 150px; resize: vertical; }
    </style>
</head>
<body>
<div class="main-container">
    <div class="header">
        <h1>بحث عن BIN</h1>
        <div class="highlight">ابحث في قاعدة البيانات الخاصة بنا عن أي أرقام BIN / IIN باستخدام هذه الأداة</div>
        <p>ابدأ البحث باختيار البلد والعلامة التجارية للبطاقة يمكنك البحث في قاعدة البيانات بأكملها مجاناً على مدار الساعة طوال أيام الأسبوع يمكنك تصفية النتائج وفرزها وتصديرها كما تريد</p>
    </div>

    <div class="filter-grid" id="filterGrid">
        <div class="combobox-container">
            <input type="text" id="countryInput" class="combobox-input" placeholder="حدد الدولة">
            <div class="suggestions-box" id="countrySuggestions"></div>
        </div>
        <div class="combobox-container">
            <input type="text" id="brandInput" class="combobox-input" placeholder="اختر العلامة التجارية">
            <div class="suggestions-box" id="brandSuggestions"></div>
        </div>
        <div class="combobox-container">
            <input type="text" id="bankInput" class="combobox-input" placeholder="حدد البنك">
            <div class="suggestions-box" id="bankSuggestions"></div>
        </div>
        <div class="combobox-container">
            <input type="text" id="typeInput" class="combobox-input" placeholder="اختر النوع">
            <div class="suggestions-box" id="typeSuggestions"></div>
        </div>
        <div class="combobox-container">
            <input type="text" id="levelInput" class="combobox-input" placeholder="اختر تصنيف">
            <div class="suggestions-box" id="levelSuggestions"></div>
        </div>
    </div>

    <div class="button-group" id="buttonGroup">
        <button id="searchBtn" class="button btn-primary" disabled>بحث (جاري التحميل...)</button>
        <button id="resetBtn" class="button btn-secondary">إعادة تعيين</button>
    </div>

    <div class="results-section" id="resultsSection">
        <div class="results-header">
            <h3 id="resultsCount"></h3>
            <button id="exportBinsBtn" class="button btn-export">تصدير النتائج TXT</button>
        </div>
        <div style="max-height: 400px; overflow-y: auto;">
            <table id="resultsTable"><thead><tr><th>BIN</th><th>الماركة</th><th>البنك</th><th>الدولة</th><th>إجراء</th></tr></thead><tbody></tbody></table>
        </div>
    </div>
</div>

<div id="genModal" class="modal">
    <div class="modal-content">
        <h3>توليد بطاقات من BIN: <span id="modalBin"></span></h3>
        <div class="modal-body">
            <input type="number" id="genQuantity" value="10" min="1" max="5000" class="combobox-input" placeholder="العدد">
            <select id="genMonth" class="combobox-input"><option value="rnd">شهر عشوائي</option></select>
            <input type="number" id="genYear" class="combobox-input" placeholder="سنة عشوائية (YYYY)">
            <textarea id="genResult" readonly class="combobox-input"></textarea>
        </div>
        <button id="exportCardsBtn" class="button btn-primary" style="width:100%;">توليد وتصدير</button>
        <button onclick="document.getElementById('genModal').style.display='none'" class="button btn-secondary" style="width:100%; margin-top:10px;">إغلاق</button>
    </div>
</div>

<script>
    const workerScript = `
        self.onmessage = (e) => {
            const text = e.data; const lines = text.split('\\n'); const data = [];
            for (let i = 1; i < lines.length; i++) {
                const parts = lines[i].split(',').map(f => f.replace(/"/g, '').trim());
                if (parts.length >= 10 && parts[0]) {
                    data.push({ bin: parts[0], brand: parts[1], type: parts[2], level: parts[3], bank: parts[4], country: parts[9] });
                }
            } self.postMessage(data);
        };`;
    const worker = new Worker(URL.createObjectURL(new Blob([workerScript])));
    let allBinsData = []; let currentFilters = {}; let optionsCache = {};

    const searchBtn = document.getElementById('searchBtn');
    const inputs = {
        country: { el: document.getElementById('countryInput'), suggestions: document.getElementById('countrySuggestions') },
        brand: { el: document.getElementById('brandInput'), suggestions: document.getElementById('brandSuggestions') },
        bank: { el: document.getElementById('bankInput'), suggestions: document.getElementById('bankSuggestions') },
        type: { el: document.getElementById('typeInput'), suggestions: document.getElementById('typeSuggestions') },
        level: { el: document.getElementById('levelInput'), suggestions: document.getElementById('levelSuggestions') },
    };

    worker.onmessage = e => {
        allBinsData = e.data;
        searchBtn.disabled = false;
        searchBtn.textContent = 'بحث';
        updateAvailableOptions();
    };

    fetch('https://raw.githubusercontent.com/venelinkochev/bin-list-data/refs/heads/master/bin-list-data.csv')
        .then(res => res.text()).then(text => worker.postMessage(text))
        .catch(() => {
            searchBtn.textContent = 'خطأ في التحميل';
            searchBtn.style.backgroundColor = '#dc3545';
        });

    function updateAvailableOptions() {
        let filteredData = allBinsData;
        for (const key in currentFilters) {
            if (currentFilters[key]) {
                filteredData = filteredData.filter(item => item[key] === currentFilters[key]);
            }
        }
        optionsCache = { country: new Set(), brand: new Set(), bank: new Set(), type: new Set(), level: new Set() };
        filteredData.forEach(item => {
            for (const key in optionsCache) if (item[key]) optionsCache[key].add(item[key]);
        });
        for (const key in inputs) {
            const currentVal = inputs[key].el.value;
            if (currentVal && !optionsCache[key].has(currentVal)) {
                 if (!currentFilters[key]) inputs[key].el.value = '';
            }
        }
    }

    Object.entries(inputs).forEach(([key, {el, suggestions}]) => {
        el.addEventListener('input', () => showSuggestions(key));
        el.addEventListener('focus', () => showSuggestions(key));
        el.addEventListener('change', () => { currentFilters[key] = el.value; updateAvailableOptions(); });
    });

    function showSuggestions(key) {
        const { el, suggestions } = inputs[key];
        const term = el.value.toLowerCase();
        suggestions.innerHTML = '';
        const options = [...(optionsCache[key] || [])].sort();
        options.filter(o => o.toLowerCase().includes(term)).slice(0, 100).forEach(opt => {
            const item = document.createElement('div');
            item.className = 'suggestion-item'; item.textContent = opt;
            item.onclick = () => { el.value = opt; suggestions.style.display = 'none'; el.dispatchEvent(new Event('change')); };
            suggestions.appendChild(item);
        });
        suggestions.style.display = suggestions.hasChildNodes() ? 'block' : 'none';
    }

    document.addEventListener('click', e => {
        if (!e.target.closest('.combobox-container')) {
            Object.values(inputs).forEach(({suggestions}) => suggestions.style.display = 'none');
        }
    });

    searchBtn.onclick = () => {
        let results = allBinsData;
        Object.entries(inputs).forEach(([key, {el}]) => {
            if (el.value) results = results.filter(item => item[key] === el.value);
        });
        const tableBody = document.querySelector('#resultsTable tbody');
        tableBody.innerHTML = '';
        results.slice(0, 500).forEach(bin => {
            tableBody.innerHTML += `<tr><td>${bin.bin}</td><td>${bin.brand}</td><td>${bin.bank}</td><td>${bin.country}</td><td><button class="button btn-primary" style="padding:5px 10px;" onclick="openGenModal('${bin.bin}')">GEN</button></td></tr>`;
        });
        document.getElementById('resultsSection').style.display = 'block';
        document.getElementById('resultsCount').textContent = `النتائج: ${results.length}`;
        window.currentResults = results;
    };

    document.getElementById('resetBtn').onclick = () => {
        Object.values(inputs).forEach(({el}) => el.value = '');
        currentFilters = {}; updateAvailableOptions();
        document.getElementById('resultsSection').style.display = 'none';
        window.currentResults = [];
    };

    document.getElementById('exportBinsBtn').onclick = () => {
        if (window.currentResults && window.currentResults.length > 0) {
            const text = window.currentResults.map(b => b.bin).join('\n');
            downloadFile(text, 'bins_export.txt');
        }
    };
    
    function openGenModal(bin) {
        document.getElementById('modalBin').textContent = bin;
        document.getElementById('genResult').value = '';
        document.getElementById('genModal').style.display = 'flex';
        window.currentBinForGen = bin;
    }

    const monthSelect = document.getElementById('genMonth');
    for(let i = 1; i <= 12; i++) monthSelect.add(new Option(i.toString().padStart(2, '0'), i));

    document.getElementById('exportCardsBtn').onclick = () => {
        const bin = window.currentBinForGen, quantity = parseInt(document.getElementById('genQuantity').value) || 10;
        const monthOpt = monthSelect.value, yearOpt = document.getElementById('genYear').value;
        let cards = [];
        for (let i = 0; i < quantity; i++) {
            let base = bin;
            while (base.length < 15) base += Math.floor(Math.random() * 10);
            
            let sum = 0;
            let double = true;
            for (let j = base.length - 1; j >= 0; j--) {
                let digit = parseInt(base[j], 10);
                if (double) {
                    digit *= 2;
                    if (digit > 9) digit -= 9;
                }
                sum += digit;
                double = !double;
            }
            
            const checkDigit = (10 - (sum % 10)) % 10;
            const cc = base + checkDigit;

            const month = monthOpt === 'rnd' ? (Math.floor(Math.random() * 12) + 1).toString().padStart(2, '0') : monthOpt.toString().padStart(2, '0');
            let year = yearOpt ? yearOpt : (new Date().getFullYear() + Math.floor(Math.random() * 6) + 2);
            year = year.toString().slice(-2);
            const cvv = (Math.floor(Math.random() * 900) + 100).toString();
            cards.push(`${cc}|${month}|${year}|${cvv}`);
        }
        const text = cards.join('\n');
        document.getElementById('genResult').value = text;
        downloadFile(text, `cards_${bin}.txt`);
    };

    function downloadFile(content, filename) {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([content], {type: 'text/plain'}));
        a.download = filename; a.click(); URL.revokeObjectURL(a.href);
    }
</script>
</body>
</html>